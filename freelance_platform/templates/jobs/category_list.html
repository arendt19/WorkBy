{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Categories" %} | WorkBy{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row mb-4">
        <div class="col-lg-12">
            <h1 class="mb-2">{% trans "Browse Categories" %}</h1>
            <p class="lead text-muted mb-4">{% trans "Find projects in your area of expertise" %}</p>

            <!-- Поиск и фильтрация категорий -->
            <div class="mb-4">
                <div class="row">
                    <div class="col-md-8">
                        <div class="input-group">
                            <span class="input-group-text bg-dark border-secondary"><i class="fas fa-search"></i></span>
                            <input type="text" id="categorySearch" class="form-control bg-dark border-secondary" placeholder="{% trans 'Search categories...' %}">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <select id="categoryFilter" class="form-select bg-dark border-secondary">
                            <option value="all">{% trans "All categories" %}</option>
                            <option value="has-projects">{% trans "Only with active projects" %}</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="categoriesList">
        {% for category in categories %}
        <div class="col-md-4 mb-4 category-item" data-projects-count="{{ category.projects.count }}">
            <!-- Сделать всю карточку кликабельной -->
            <a href="{% url 'jobs:category_detail' category.slug %}" class="text-decoration-none">
                <div class="card h-100 shadow-sm category-card {% if category.projects.count == 0 %}inactive-category{% endif %}">
                    <div class="card-body d-flex flex-column">
                        <!-- Иконка категории в соответствии с ее типом -->
                        <div class="category-icon-wrapper mb-3">
                            {% if category.slug == 'seo-smm' %}
                                <div class="category-icon"><i class="fas fa-chart-line"></i></div>
                            {% elif category.slug == 'audio-video' %}
                                <div class="category-icon"><i class="fas fa-video"></i></div>
                            {% elif category.slug == 'web-development' %}
                                <div class="category-icon"><i class="fas fa-laptop-code"></i></div>
                            {% elif category.slug == 'design' %}
                                <div class="category-icon"><i class="fas fa-palette"></i></div>
                            {% elif category.slug == 'content-copywriting' %}
                                <div class="category-icon"><i class="fas fa-feather-alt"></i></div>
                            {% elif category.slug == 'marketing' %}
                                <div class="category-icon"><i class="fas fa-bullhorn"></i></div>
                            {% elif category.slug == 'mobile-development' %}
                                <div class="category-icon"><i class="fas fa-mobile-alt"></i></div>
                            {% elif category.slug == 'translation' %}
                                <div class="category-icon"><i class="fas fa-language"></i></div>
                            {% else %}
                                <div class="category-icon"><i class="fas fa-folder"></i></div>
                            {% endif %}
                        </div>
                        
                        <h5 class="card-title mb-2">{{ category.get_translated_name }}</h5>
                        <p class="card-text text-muted mb-3">
                            <span class="badge bg-{% if category.projects.count > 0 %}primary{% else %}secondary{% endif %}">
                                {{ category.projects.count }} {% trans "Projects" %}
                            </span>
                        </p>
                        <div class="mt-auto">
                            {% if category.projects.count > 0 %}
                                <span class="btn btn-outline-primary w-100">
                        {% trans "Browse" %} {{ category.get_translated_name }}
                                </span>
                            {% else %}
                                <span class="btn btn-outline-secondary w-100 disabled">
                                    {% trans "No active projects" %}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </a>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="alert alert-info">
                {% trans "No categories found." %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    // Функция для поиска и фильтрации категорий
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('categorySearch');
        const filterSelect = document.getElementById('categoryFilter');
        const categoryItems = document.querySelectorAll('.category-item');
        
        // Функция фильтрации по поиску и выбранному фильтру
        function filterCategories() {
            const searchTerm = searchInput.value.toLowerCase();
            const filterValue = filterSelect.value;
            
            categoryItems.forEach(item => {
                const title = item.querySelector('.card-title').textContent.toLowerCase();
                const projectsCount = parseInt(item.getAttribute('data-projects-count'), 10);
                
                const matchesSearch = title.includes(searchTerm);
                const matchesFilter = filterValue === 'all' || 
                                      (filterValue === 'has-projects' && projectsCount > 0);
                
                if (matchesSearch && matchesFilter) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // Обработчики событий для поиска и фильтра
        searchInput.addEventListener('input', filterCategories);
        filterSelect.addEventListener('change', filterCategories);
    });
</script>
{% endblock %} 